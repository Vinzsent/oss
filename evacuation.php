<?php
// Start session to access user data
session_start();

// Include database configuration file
include('config.php');
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro OSS App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
    <style>
        /* Mobile-first responsive map container */
        .map-container {
            height: 400px;
        }
        
        /* Tablet and larger screens */
        @media (min-width: 768px) {
            .map-container {
                height: 600px;
            }
        }
        
        /* Desktop screens */
        @media (min-width: 992px) {
            .map-container {
                height: 70vh;
            }
        }
        
        /* Mobile spacing adjustments */
        @media (max-width: 767px) {
            .container {
                padding-left: 15px;
                padding-right: 15px;
            }
            
            h2 {
                font-size: 1.5rem;
                margin-bottom: 1rem;
            }
            
            .form-group {
                margin-bottom: 1rem;
            }
            
            .alert {
                padding: 0.75rem;
                font-size: 0.9rem;
            }
            
            .btn {
                width: 100%;
                margin-top: 0.5rem;
            }
        }
	
		.navigation-bar {
            display: flex;
            justify-content: center;
            background-color: #f8f9fa;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
        }

        .nav-link {
            display: flex;
            align-items: center;
            margin: 0 15px;
            text-decoration: none;
            color: #007bff;
            font-weight: 600;
            font-size: 16px;
            transition: color 0.3s, transform 0.3s;
        }

        .nav-link:hover {
            color: #0056b3;
            transform: scale(1.05);
        }

        .nav-link i {
            margin-right: 8px;
        }

    </style>




</head>

<body>
    <?php include('includes/nav.php'); ?>
    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8">
                <h2>Evacuation Map</h2>
                <div id="map" class="map-container bg-light">
                    <!-- Map placeholder -->
                    <div id="hazard-map" style="width: 100%; height: 100%;"></div>
                </div>
            </div>
            <div class="col-md-4">
                <h2>Barangay Maps</h2>
                <div class="alert alert-info">
                    <strong>Search for Barangay:</strong>
                </div>
                <div class="alert-settings">
                    <form>
                        <div class="form-group">
                            <label for="notificationType">Select Barangay</label>
                            <select class="form-control" id="notificationType" onchange="focusBarangay()">
                                <option value="">Select Barangay</option>
                                <option value="daliao">Daliao</option>
                                <option value="lizada">Lizada</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="frequency"><strong>Purok/Sitio</strong></label>
                            <select class="form-control" id="frequency" onchange="focusSitioAndRoute()">
                                <option>--Select--</option>
                            </select>
                        </div>
                        <button type="submit" class="btn btn-primary">Clear</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    
    <footer class="bg-dark text-white mt-5 p-4 text-center">
        &copy; 2024 Flood Resilience App. All Rights Reserved.
    </footer>

    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@3.2.12/dist/leaflet-routing-machine.min.js"></script>
    <script>
        // Initialize the map
        var map = L.map('hazard-map').setView([7.028012, 125.447948], 12); // Coordinates for Toril, Davao City

        // Add a tile layer
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // Define the coordinates for the polygon (approximate boundary of Toril District)
        var torilPolygon = [
            [7.018062776420971, 125.51589655144308], 
            [7.028150096767495, 125.50329383468966], 
            [7.039374379364794, 125.49429404074982], 
            [7.040732015645277, 125.49554396295903], 
            [7.042824386131733, 125.49305017586639],
            [7.044750018500051, 125.49335955592852],
			[7.044904673296006, 125.49055164471905],
			[7.04665586053899, 125.49060890692336],
			[7.04662521349712, 125.49199318901087],
			[7.048858994987622, 125.49307335297912],
			[7.049499772738594, 125.49527027057442],
			[7.0515434658970015, 125.49511478444524],
			[7.052000976106928, 125.4919551379514],
			[7.056089645563646, 125.4951833300361],
			[7.062039969893626, 125.48682150800136],
			[7.080711564480447, 125.48378193086386],
			[7.080285493000759, 125.4689313660974],
			[7.09500525480403, 125.46878810012916],
			[7.094386772975045, 125.45259213836141],
			[7.091552114506784, 125.45279437148905],
			[7.09088424852427, 125.44425605417062],
			[7.090030216175618, 125.44421226436019],
			[7.090011426271663, 125.4423248790404],
			[7.089909815270921, 125.43752758003077],
			[7.089932009391595, 125.43692467489527],
			[7.0898049132055085, 125.4363996324822],		
			[7.090175673072413, 125.43548882048566],
			[7.090100807976832, 125.43497008980198],
			[7.089927797516003, 125.43450942041297],
			[7.089981031511083, 125.43415738048341],
			[7.089587311868933, 125.43255350186969],
			[7.089735701723565, 125.4317401219877],
			[7.089629899096844, 125.43109572126735],
			[7.089609270909125, 125.43023674384119],
			[7.08984216975272, 125.4293214400108],
			[7.089866125056505, 125.42839205459369],
			[7.090077557320878, 125.42776877858866],
			[7.090160735408427, 125.42731816747911],
			[7.090113490257358, 125.42690242507744],
			[7.089905877702954, 125.42656983115863],
			[7.09041985056315, 125.42258727842795],
			[7.090215865741033, 125.42197545951454],
			[7.090143640522058, 125.42109848878215],
			[7.09044860831441, 125.42054088610492],
			[7.0904372961022, 125.41986563998361],
			[7.090172782616812, 125.41934067174905],
			[7.090470227329999, 125.41860239371412],
			[7.090518803292612, 125.41828052865137],
			[7.0904575842696165, 125.41784668134086],
			[7.0900676455157745, 125.41707152293024],
			[7.090034374276987, 125.41682341858977],
			[7.090037035976549, 125.41624808476271],
			[7.090655479433974, 125.41541740345777],
			[7.090788564200163, 125.41498489724917],
			[7.090933597600313, 125.41309654917117],
			[7.091018771804362, 125.41287258471415],
			[7.091038069082957, 125.41221074964747],
			[7.090984169784869, 125.41202634777248],
			[7.0908450962653005, 125.41177891400548],
			[7.090812490503461, 125.4113484194426],
			[7.090865724396902, 125.41112981940843],
			[7.091139878849246, 125.41036740149507],
			[7.091328193584309, 125.41006230022145],
			[7.091606340295274, 125.40978402103262],
			[7.09266635719578, 125.40845833923903],
			[7.092758850712267, 125.4081632962361],
			[7.09258382595368, 125.40753106270888],
			[7.09225100751883, 125.40665998301954],
			[7.092239960132199, 125.40490934223675],
			[7.091941185721386, 125.404147594878],
			[7.09172958145394, 125.40399739117328],
			[7.091336316664721, 125.40350051195432],
			[7.091252473366158, 125.40319339902237],
			[7.09128241740322, 125.40283130080894],
			[7.091472728347542, 125.40248864860028],
			[7.091843368666034, 125.40202797920686],
			[7.091920557636896, 125.40185296506819],
			[7.091796789110814, 125.40164040000552],
			[7.091326335321267, 125.40120990545314],
			[7.091285744519834, 125.4009799060241],
			[7.091579861398632, 125.39971390336585],
			[7.09164440738481, 125.39918751985743],
			[7.091603816610144, 125.398728191558],
			[7.0915379397731355, 125.39838889212454],
			[7.091432802983348, 125.3981716331973],
			[7.091243157445797, 125.39796845585761],
			[7.091126042970417, 125.39760568708564],
			[7.09106815114547, 125.39725029439333],
			[7.091108741966472, 125.39693379372562],
			[7.0911859310588685, 125.39658242433984],
			[7.091217205946267, 125.39587901503879],
			[7.09112271585112, 125.39569260150428],
			[7.090803312583094, 125.39525338978426],
			[7.090453965002709, 125.39494426519761],
			[7.090079331015133, 125.39431863994051],
			[7.089953565720359, 125.39393173128903],
			[7.089978851868933, 125.39364674657672],
			[7.090424276536255, 125.3930698458559],
			[7.090640410940734, 125.392817389523],
			[7.090642407212827, 125.39242645754967],
			[7.090555236667146, 125.39225814892849],
			[7.090299048330198, 125.39192086115017],
			[7.090060826319683, 125.3915084715159],
			[7.090122045395526, 125.39123220398412],
			[7.090140011860172, 125.3909827585571],
			[7.090066149717371, 125.39074672416736],
			[7.089185126472441, 125.38973754302714],
			[7.08920642010436, 125.38950352027113],
			[7.089310891978493, 125.38934459939254],
			[7.09003620560129, 125.38857212320097],
			[7.090129365068664, 125.3882925029059],
			[7.090110733176205, 125.3880752439664],
			[7.089303473891639, 125.38740968491692],
			[7.0893340834797565, 125.38653126147621],
			[7.089436559048298, 125.38640922096003],
			[7.089469164906573, 125.3862583466974],
			[7.089479146290979, 125.38597470309298],
			[7.089485710691855, 125.38597756231977],
			[7.089418611648024, 125.3857846823149],
			[7.089270221689641, 125.38546885220279],
			[7.088664683700993, 125.3849538680759],
			[7.0881596244803875, 125.38463334409664],
			[7.087936030081442, 125.38463974892892],
			[7.0876266060270945, 125.38433196543879],
			[7.0874402860653305, 125.38403826354346],
			[7.087382393776278, 125.38366610705282],
			[7.087185426852466, 125.38296403884252],
			[7.087033709028297, 125.3827541559914],
			[7.085750458021037, 125.38284964266515],
			[7.085282819859977, 125.38277540361776],
			[7.084958754514798, 125.38233485078533],
			[7.084946952921797, 125.38207215343824],
			[7.084840483764462, 125.38183947181996],
			[7.084652166375887, 125.381504866234],
			[7.084531723061851, 125.381244021402],
			[7.084509763779314, 125.380864488823],
			[7.084332758618978, 125.38028781388944],
			[7.084135790394307, 125.38011481141095],
			[7.083924847976347, 125.37995253776337],
			[7.082348149549951, 125.37924452702273],
			[7.082085302284349, 125.37905006686374],
			[7.0813892553926, 125.37865578214424],
			[7.081021268417642, 125.37821791152649],
			[7.0806027078285325, 125.37792823295084],
			[7.07968107467514, 125.37759496848398],
			[7.079504067663798, 125.37740251999544],
			[7.079289130483558, 125.37710747699919],
			[7.078965726369897, 125.37694252114218],
			[7.0782357372364535, 125.37694922666493],
			[7.077808523370299, 125.37685534934475],
			[7.077543011748444, 125.3767688481023],
			[7.077415246703184, 125.37666088919217],
			[7.076823667466206, 125.37653147260728],
			[7.076237411028729, 125.37631622533016],
			[7.07512412064924, 125.37625453452306],
			[7.074922490361702, 125.37618680874664],
			[7.074724852668195, 125.37616132776374],
			[7.07439212909671, 125.37603995780911],
			[7.073936962852355, 125.37595345656617],
			[7.073455843663201, 125.37576771359369],
			[7.0730233017758755, 125.37548071721899],
			[7.072701224172045, 125.37523395399343],
			[7.072466320321624, 125.37495433370458],
			[7.072156885891824, 125.37481754104755],
			[7.071836138582341, 125.3747209815263],
			[7.071364333529546, 125.37471561710645],
			[7.071181334259675, 125.37468544225334],
			[7.070970385921023, 125.37461101095148],
			[7.07086923715556, 125.37450908700586],
			[7.070355507564503, 125.37411815504285],
			[7.070065369875032, 125.37381908873583],
			[7.069834457408454, 125.37353611568912],
			[7.06961286118697, 125.37338859419376],
			[7.069402577586308, 125.37310360948798],
			[7.069187635705311, 125.37290512602051],
			[7.06878503532035, 125.37242366950149],
			[7.068522180334067, 125.37222116271941],
			[7.068327867186509, 125.37201798539306],
			[7.067994473542634, 125.3717557994632],
			[7.067804818369683, 125.37171154301133],
			[7.067524660936322, 125.37159620801569],
			[7.067337001942438, 125.37165991047877],
			[7.066719456919958, 125.37134005705434],
			[7.066553757736252, 125.37112078646788],
			[7.066123205767734, 125.37015317957191],
			[7.065964160965494, 125.36991178075758],
			[7.065053145964839, 125.3691030947443],
			[7.064785630628113, 125.36906353216305],
			[7.060983068373198, 125.37028788884261],
			[7.0598122603594815, 125.37255545357252],
			[7.061140726172538, 125.37394009846248],
			[7.062495805505166, 125.3760332575533],
			[7.063064777328287, 125.37667497605834],
			[7.063515961501195, 125.37698946506414],
			[7.063977127172323, 125.37722885221247],
			[7.064290559853954, 125.37714369208221],
			[7.064566061015196, 125.37712357551622],
			[7.064735753679646, 125.37734888108288],
			[7.064757048439618, 125.37762380751037],
			[7.064645916394508, 125.37790141614495],
			[7.064676527621501, 125.37823803337264],
			[7.06485620216123, 125.37846333892328],
			[7.065123717456913, 125.37865914017564],
			[7.065542957536494, 125.37888444573629],
			[7.06596286269395, 125.37917814761876],
			[7.066447982438382, 125.37958584338209],
			[7.067348347369664, 125.38050852328398],
			[7.067519369927699, 125.3807170650392],
			[7.067677083282181, 125.38080155462265],
			[7.067751614468628, 125.38097656876162],
			[7.067756938124247, 125.38129709274085],
			[7.068293296115606, 125.38245245427095],
			[7.068549496674661, 125.38272603959209],
			[7.0687032169413255, 125.38306735068997],
			[7.068773755230407, 125.38331344337638],
			[7.068729835167038, 125.3836467078434],
			[7.068729169712075, 125.38409731895372],
			[7.06886292625893, 125.38466393561555],
			[7.069123119231003, 125.38551151365141],
			[7.069383312057193, 125.38573883087632],
			[7.069612893841395, 125.38602247448144],
			[7.069700068343788, 125.38631349415566],
			[7.069783250105398, 125.38802072019006],
			[7.069880406385148, 125.38844182700697],
			[7.069855784590835, 125.38889377922052],
			[7.06980654099715, 125.38915931791765],
			[7.06979123555518, 125.38938730568472],
			[7.068559478515973, 125.38908823938124],
			[7.068004488046817, 125.38877643258007],
			[7.067440180510457, 125.38852899880182],
			[7.066933767143202, 125.38814343125274],
			[7.066716827739225, 125.38801334411225],
			[7.066481920847801, 125.38779005021317],
			[7.0661412058208946, 125.38711346299202],
			[7.065649431153654, 125.38699946911007],
			[7.065246827686278, 125.38684457153646],
			[7.064784997822143, 125.3864804616605],
			[7.064848216635826, 125.38584611923551],
			[7.064784997821112, 125.38553163022996],
			[7.064694495085503, 125.38524396330634],
			[7.064694495085503, 125.38524396330634],
			[7.06345473890589, 125.3840222171034],
			[7.062820552094701, 125.38356959433477],
			[7.062630229333703, 125.38329064459928],
			[7.062308144485154, 125.38305393965621],
			[7.0609951805770566, 125.38283936292972],
			[7.058861157866583, 125.38211046399474],
			[7.058053084464214, 125.38135383854957],
			[7.057969235121592, 125.38091127407058],
			[7.057818838642517, 125.38050089609604],
			[7.057052363674511, 125.37981368434473],
			[7.056905294259901, 125.3792792541992],
			[7.056898639533905, 125.37878706884493],
			[7.056475939908435, 125.37850452499819],
			[7.05624169328875, 125.37825038569838],
			[7.055117743525021, 125.37715687396201],
			[7.054858873623225, 125.37678739967447],
			[7.054238745161758, 125.37616613239254],
			[7.0540458045367345, 125.37513656025868],
			[7.052981517828958, 125.37455485552609],
			[7.052706675248635, 125.3742738941353],
			[7.052367281038762, 125.37401774317856],
			[7.052172295622667, 125.37350611181024],	
			[7.051681837068075, 125.3731198737081],
			[7.050913004793965, 125.37271001375849],
			[7.050253050522808, 125.3725183932313],
			[7.049821152423807, 125.37220524533079],
			[7.049702357868187, 125.3719611056925],
			[7.049408257092154, 125.37106346795352],
			[7.049291797493581, 125.37079122373717],
			[7.049166686575135, 125.37069198200327],
			[7.049044237561436, 125.37051160344409],
			[7.048915133674049, 125.37041772612942],
			[7.048799339434105, 125.37029568561783],
			[7.0485511137566235, 125.37014548191783],
			[7.048279595972115, 125.37003819355387],
			[7.0480313700123425, 125.36978405424811],
			[7.0477932277516535, 125.3694574289879],
			[7.047647486367372, 125.36916439765358],
			[7.046348456131446, 125.37073885434022],
			[7.041443410994, 125.37121249246356],
			[7.041470030783271, 125.37161482382655],
			[7.0417082958612705, 125.37220911504195],
			[7.041984475951258, 125.37263156295498],
			[7.042626999165728, 125.3749221794337],
			[7.042709198154351, 125.3754175000778],
			[7.042717269899491, 125.37571520569865],
			[7.042662699475231, 125.37618727448671],
			[7.0421745891410295, 125.3771863650637],
			[7.041902402130286, 125.37757595591322],
			[7.041832525242385, 125.37780260258069],
			[7.041722053189151, 125.37801650875353],
			[7.041580302866572, 125.37841951065643],
			[7.041364017076353, 125.37855026834256],
			[7.04121760817929, 125.37903105430988],
			[7.041185664412974, 125.37945014947032],
			[7.041227590605174, 125.37992422991354],
			[7.041612912099721, 125.38036344163196],
			[7.041908391577649, 125.38038624041106],
			[7.042281068126305, 125.38070877604503],
			[7.0425998394386875, 125.38117883317459],
			[7.0430137759705875, 125.3815865289386],
			[7.043220078607083, 125.38190705293046],
			[7.043241374359121, 125.3827988874145],
			[7.043207434256694, 125.38303693347359],
			[7.042859381684961, 125.38352174274723],
			[7.042858050698714, 125.38382013851695],
			[7.04294323376062, 125.38411182873007],
			[7.0429745119128055, 125.3845959674635],
			[7.042873357032027, 125.38475153559202],
			[7.041692771438709, 125.38509552889266],
			[7.0369499595914675, 125.38511690862838],
			[7.037009854697457, 125.38614955912008],
			[7.037387566373032, 125.38764935490138],
			[7.037479405445598, 125.3879303162962],
			[7.038457907329111, 125.38908650627803],
			[7.038477872300113, 125.38989787451078],
			[7.0382609195670565, 125.39076355745757],
			[7.0382076796167174, 125.39127049496443],
			[7.0379414797738455, 125.39168288460633],
			[7.037845647793036, 125.39234136691668],
			[7.037569465238385, 125.3929918026044],
			[7.037674750452878, 125.39414519872452],
			[7.037457797343917, 125.39487610067997],
			[7.037699373957361, 125.39527373816145],
			[7.037881720959841, 125.39594429040292],
			[7.036977766996551, 125.39612203350755],
			[7.036818046686429, 125.3956801395787],
			[7.035887561271445, 125.39561042329252],
			[7.035052396175562, 125.39509584628578],
			[7.034688365381787, 125.3945299001863],
			[7.034669525579635, 125.39278936855936],
			[7.034880490455238, 125.39200348131801],
			[7.034901786588726, 125.39130141311185],
			[7.034859859825972, 125.39069724554182],
			[7.034688159708254, 125.39026675099203],
			[7.033715964372005, 125.39007507325202],
			[7.033200197051445, 125.38960501613033],
			[7.032713528786093, 125.38843653110868],
			[7.032386741880934, 125.38745218625519],
			[7.0321937445906135, 125.387108863505],
			[7.0315180803994535, 125.38615090797934],
			[7.031003632518899, 125.38496103332717],
			[7.030639723317652, 125.38316079704437],
			[7.029107027966783, 125.37952318577497],
			[7.0286621185150215, 125.37589890409743],
			[7.028685904154713, 125.37443426341561],
			[7.028865847913244, 125.37350747105477],
			[7.027253414164997, 125.37318521940527],
			[7.021661975400143, 125.37085772099032],
			[7.021250031791886, 125.36803687743466],
			[7.02032356905543, 125.36803592648418],
			[7.015254894136891, 125.3641949427556],
			[7.014743883790574, 125.35882006408701],
			[7.010409662641442, 125.35832718535626],
			[7.004691580217226, 125.35846629530384],
			[7.0037857062090145, 125.35999992921994],
			[6.991159631779453, 125.35940012749757],
			[6.989951828044633, 125.35605186975438],
			[6.979049020849736, 125.35124652298306],
			[6.9752150791548555, 125.35499150422079],
			[6.965814501511897, 125.4667602616915],
			[6.961212453998897, 125.47542876736463],
			[6.961750550199877, 125.48494916213478],
			[6.963527695348807, 125.48348793768953],
			[6.971585135589139, 125.4848597954117],
			[6.977859685019337, 125.48590105121389],
			[6.999110725451906, 125.50412440367693],
			[7.004303524557448, 125.5081890299095],
			[7.007014351462701, 125.50671215304092],
			[7.007014351462701, 125.50671215304092],
			[7.008293525194234, 125.50762361688705],
			[7.008213664395716, 125.50773868154549],
			[7.0082768909122315, 125.50793045948164],
			[7.008278599618569, 125.50793183276579],
			[7.008470254814937, 125.50800281784328],
			[7.012345660579676, 125.5124073159746],
			[7.014144474835539, 125.51596198408427],
			[7.014149221668266, 125.5160039945193],
			[7.015612977443331, 125.51789033914326],
			[7.0159050763022694, 125.51763107273149],
			[7.0151006111016345, 125.51682769011839],
			[7.015211599293221, 125.5161266562065],
			[7.017126470215042, 125.51560736074482]
        ];
        // Add a polygon around the Toril area
        var torilLayer = L.polygon(torilPolygon, {color: 'blue', weight: 2, fillOpacity: 0.2}).addTo(map);

        // Add flood hazard layer
        // var floodHazardLayer = L.tileLayer.wms("http://geoserver-website/noah/geoserver/wms?", {
        //     layers: 'project_noah:flood_hazard',
        //     format: 'image/png',
        //     transparent: true,
        //     attribution: "Project NOAH"
        // }).addTo(map);

        // Define barangays and sitios
        var barangays = {
            daliao: {
                coordinates: [7.008845440178282, 125.50380745678764],
                polygon: [
                    [7.01828063220729, 125.51608513150374],
					[7.024070872598773, 125.50828703405678],
					[7.01120142868577, 125.502050827483],
					[7.014015419851456, 125.49884766191978],
					[7.011323988580959, 125.4965124856025],
					[7.010975987094289, 125.49679390834005],
					[7.00522769874236, 125.50441383623887],
					[7.00430386236224, 125.50633510314647],
					[7.0047198895345355, 125.50655924692606],
					[7.005841546206657, 125.50708508660493],
					[7.005590747484002, 125.50755555127753],
					[7.005083844761996, 125.50774877553279],
					[7.005111359483901, 125.50785216895095],
					[7.005659498739708, 125.50766697928198],
					[7.006220385245537, 125.5065729268397],
					[7.007014351462701, 125.50671215304092],
					[7.008293525194234, 125.50762361688705],
					[7.008213664395716, 125.50773868154549],
					[7.0082768909122315, 125.50793045948164],
					[7.008278599618569, 125.50793183276579],
					[7.008470254814937, 125.50800281784328],
					[7.012345660579676, 125.5124073159746],
					[7.014144474835539, 125.51596198408427],
					[7.014149221668266, 125.5160039945193],
					[7.015612977443331, 125.51789033914326],
					[7.0159050763022694, 125.51763107273149],
					[7.0151006111016345, 125.51682769011839],
					[7.015211599293221, 125.5161266562065],
					[7.017126470215042, 125.51560736074482]
                ],
                evacuationRoutes: [
                    { start: [7.008885037971703, 125.50379265512842], end: [7.008885037971703, 125.50379265512842] },
                    { start: [7.008885037971703, 125.50379265512842], end: [7.008885037971703, 125.50379265512842] }
                ],
                safeZones: [
                    { coordinates: [7.009390752578677, 125.50171445559366], name: 'Nakada' },
                    { coordinates: [7.010321221253498, 125.49893911769212], name: 'Doña Rosa Phase 1' },
                    { coordinates: [7.015831, 125.509114], name: 'Kalayaan' },
                    { coordinates: [7.0170, 125.5070], name: 'Kalubin-an' },
                    { coordinates: [7.00539178227548, 125.50527172131225], name: 'Kanipaan' },
                    { coordinates: [7.0159814747894576, 125.51423251010264], name: 'Lipadas' },
                    { coordinates: [7.02183431495076, 125.50772897375354], name: 'Mcleod' },
                    { coordinates: [7.008142928861825, 125.50660241698455], name: 'Pantalan' },
                    { coordinates: [7.0146034414306, 125.50828026348327], name: 'Pogi Lawis' },
                    { coordinates: [7.016759158375993, 125.51069182752335], name: 'Prudential' },
                    { coordinates: [7.019465055353755, 125.50976464117946], name: 'St Jude' }
                ]
            },
            lizada: {
                coordinates: [7.0045, 125.5019],
                polygon: [
                    [7.003515125221749, 125.50779461119546],
					[7.004761501404554, 125.50527657411206],
                    [7.005243692483485, 125.50443043090819],
					[7.005224145582021, 125.50444752067132],
					[7.006726453649551, 125.50227829512528],
					[7.009001232130789, 125.49930184027946],
					[7.010907774301172, 125.49686337860074],
					[7.01148216104005, 125.49638191193819],
                    [7.013824289420492, 125.49580129780614],
                    [7.0135520065087595, 125.49032033616338],
                    [7.012361802824933, 125.48954523815613],
					[7.011583075816329, 125.48707588235636],
					[7.012697230713899, 125.4860751584105],
					[7.010814393752208, 125.4855704454639],
					[6.999529567710835, 125.48479456337354],
					[6.9962312997686835, 125.48569320988146],
					[6.994783040225282, 125.48513531043082],
					[6.992823623105905, 125.48736690823343],
					[6.990821601473118, 125.48659443207097],
					[6.990759867686076, 125.49006253909748],
					[6.986843791545605, 125.4894882101023],
					[6.986744649951678, 125.49073675139618],
					[6.988900974874856, 125.49390804628268]
                ],
                evacuationRoutes: [
                    { start: [7.027259, 125.497706], end: [7.0300, 125.5000] },
                    { start: [7.029175, 125.492831], end: [7.033081, 125.499271] }
                ],
                safeZones: [
                    { coordinates: [7.0081266390240105, 125.49165857313496], name: 'Babisa' },
                    { coordinates: [7.006881093590256, 125.50165566391446], name: 'Camarin' },
                    { coordinates: [7.0280, 125.4950], name: 'Culosa' },
                    { coordinates: [7.0270, 125.4975], name: 'Curvada' },
                    { coordinates: [6.999194364599137, 125.49794893914303], name: 'Dacudao' },
                    { coordinates: [7.009122661145653, 125.49789303175363], name: 'Doña Rosa' },
                    { coordinates: [7.0285, 125.4960], name: 'Fisherman' },
                    { coordinates: [7.0295, 125.4950], name: 'Glabaca' },
                    { coordinates: [7.0260, 125.4935], name: 'Gutierez' },
                    { coordinates: [7.003302614623746, 125.49671567753686], name: 'JV Ferriols' },
                    { coordinates: [7.0275, 125.4970], name: 'Kasama' },
                    { coordinates: [7.0285, 125.4945], name: 'Lawis' },
                    { coordinates: [7.0290, 125.4955], name: 'Lizada Beach' },
                    { coordinates: [7.0265, 125.4960], name: 'Lizada Proper' },
                    { coordinates: [6.9960072, 125.4923649], name: 'Malatabis' },
                    { coordinates: [7.0285, 125.4965], name: 'New Lizada' },
                    { coordinates: [7.003567897421154, 125.50239911092739], name: 'Punong' },
                    { coordinates: [7.0280, 125.4955], name: 'Riverside' },
                    { coordinates: [7.0270, 125.4945], name: 'Samuel' },
                    { coordinates: [7.0265, 125.4960], name: 'San Vicente' },
                    { coordinates: [7.003883631249645, 125.49707570645367], name: 'Sodaco' },
                    { coordinates: [7.0285, 125.4940], name: 'Sto. Niño' },
                    { coordinates: [6.996490874579091, 125.49305761848845], name: 'Tambacan' },
                    { coordinates: [7.007239610358947, 125.49891460298481], name: 'Villa Grande' },
                    { coordinates: [7.0290, 125.4945], name: 'Vision' }
                ]
            }
        };
	


        // Define specific purok locations with coordinates
        var purokLocations = {
            'San Nicolas': { coordinates: [7.0108, 125.5025], name: 'San Nicolas' },
            'Doña Rosa': { coordinates: [7.009091, 125.5058599], name: 'Doña Rosa' },
            'Duha': { coordinates: [7.009091, 125.5058599], name: 'Duha' },
            'Prudential': { coordinates: [7.016759158375993, 125.51069182752335], name: 'Prudential' },
            'Malatabis': { coordinates: [6.9960072, 125.4923649], name: 'Malatabis' }
        };

        var currentPolygon = null;
        var currentRoutes = [];
        var currentMarkers = [];
        var routingControl = null; // holds the OSRM road-following route control
        var allRoutingControls = []; // holds all routing controls

        function updateSitios() {
            var barangaySelect = document.getElementById('notificationType');
            var sitioSelect = document.getElementById('frequency');
            var selectedBarangay = barangaySelect.value;

            // Clear the sitios dropdown
            sitioSelect.innerHTML = '<option>--Select--</option>';

            if (selectedBarangay && barangays[selectedBarangay]) {
                // Add specific puroks for Daliao
                if (selectedBarangay === 'daliao') {
                    var daliaPuroks = [
                        'San Nicolas',
                        'Duha',
                    ];
                    
                    daliaPuroks.forEach(purok => {
                        var option = document.createElement('option');
                        option.value = purok;
                        option.textContent = purok;
                        sitioSelect.appendChild(option);
                    });
                }
                
                var sitios = barangays[selectedBarangay].safeZones;
                sitios.forEach(sitio => {
                    var option = document.createElement('option');
                    option.value = sitio.name;
                    option.textContent = sitio.name;
                    sitioSelect.appendChild(option);
                });
            }
        }

        function focusBarangay() {
    var selectedBarangay = document.getElementById('notificationType').value;

    if (currentPolygon) {
        map.removeLayer(currentPolygon);
    }
    currentRoutes.forEach(route => map.removeLayer(route));
    currentMarkers.forEach(marker => map.removeLayer(marker));
    allRoutingControls.forEach(control => map.removeControl(control)); // remove existing routing controls
    allRoutingControls = []; // clear routing controls array
    currentRoutes = [];
    currentMarkers = [];

    if (selectedBarangay && barangays[selectedBarangay]) {
        var barangay = barangays[selectedBarangay];
        map.setView(barangay.coordinates, 14);
        currentPolygon = L.polygon(barangay.polygon, { color: 'blue', weight: 2, fillOpacity: 0.2 }).addTo(map);

        // Add evacuation routes
        barangay.evacuationRoutes.forEach(route => {
            var routeLine = L.polyline([route.start, route.end], { color: 'red', weight: 3, dashArray: '5, 10' }).addTo(map);
            currentRoutes.push(routeLine);
        });

        // Add barangay hall marker with blue icon
        var barangayHallMarker = L.marker(barangay.coordinates, {
            icon: L.divIcon({
                className: 'barangay-hall-icon',
                html: '<i class="fa fa-map-marker-alt" style="color: #007bff; font-size: 24px;"></i>' // Blue pin icon
            })
        }).addTo(map).bindPopup(selectedBarangay.charAt(0).toUpperCase() + selectedBarangay.slice(1) + ' Barangay Hall');
        currentMarkers.push(barangayHallMarker);

        // Safe zones are no longer displayed with markers
    } else {
        map.setView([7.028012, 125.447948], 12);
    }

    // Update sitios dropdown
    updateSitios();
}

       function focusSitioAndRoute() {
    var selectedBarangay = document.getElementById('notificationType').value;
    var selectedSitio = document.getElementById('frequency').value;

    if (!selectedBarangay || !selectedSitio) return;

    // Check if selected sitio is a purok location first
    var sitio = purokLocations[selectedSitio];
    
    // If not found in purok locations, search in safe zones
    if (!sitio) {
        sitio = barangays[selectedBarangay]?.safeZones.find(zone => zone.name === selectedSitio);
    }

    if (sitio) {
        // Clear previous routes and markers
        currentRoutes.forEach(route => map.removeLayer(route));
        currentMarkers.forEach(marker => map.removeLayer(marker));
        allRoutingControls.forEach(control => map.removeControl(control)); // remove previous routing controls
        allRoutingControls = []; // clear routing controls array
        currentRoutes = [];
        currentMarkers = [];

        // Focus on selected sitio
        map.setView(sitio.coordinates, 16);

        // Sitio markers are no longer displayed

        // Special connection for Lizada to Malatabis
        if (selectedBarangay === 'lizada' && selectedSitio === 'Malatabis') {
            var lizadaToMalatabisRoute = L.polyline([
                barangays[selectedBarangay].coordinates, 
                sitio.coordinates
            ], { color: 'red', weight: 3, dashArray: '5, 10' }).addTo(map);
            currentRoutes.push(lizadaToMalatabisRoute);
        }

        // Highlight the evacuation routes
        var evacuationRoutes = barangays[selectedBarangay]?.evacuationRoutes;
        if (evacuationRoutes) {
            evacuationRoutes.forEach(route => {
                // Draw evacuation routes from selected sitio to evacuation routes
                drawEvacuationRoute(sitio.coordinates, route.end, 'red'); // Using red to highlight the route
            });

            // Evacuation center markers are no longer displayed
        }

        // Add and emphasize safe zones with arrowheads pointing towards evacuation centers
        barangays[selectedBarangay]?.safeZones.forEach(zone => {
            if (zone.name === selectedSitio) {
                // Safe zone markers are no longer displayed
            }        
        });
    }
}

function drawEvacuationRoute(start, end, color = 'blue') {
    // Use Leaflet Routing Machine with OSRM to follow the road network
    routingControl = L.Routing.control({
        waypoints: [
            L.latLng(start[0], start[1]),
            L.latLng(end[0], end[1])
        ],
        lineOptions: {
            styles: [{ color: color || 'red', weight: 5, opacity: 0.9 }]
        },
        router: L.Routing.osrmv1({
            serviceUrl: 'https://router.project-osrm.org/route/v1'
        }),
        addWaypoints: false,
        draggableWaypoints: false,
        fitSelectedRoutes: false,
        show: false,
        createMarker: function() { return null; } // we already place custom markers
    }).addTo(map);
    allRoutingControls.push(routingControl); // add routing control to array
 }

document.addEventListener('DOMContentLoaded', function() {
    var barangaySelect = document.getElementById('notificationType');
    barangaySelect.addEventListener('change', focusBarangay);

    var sitioSelect = document.getElementById('frequency');
    sitioSelect.addEventListener('change', focusSitioAndRoute);
});

</script>
</body>
</html>
